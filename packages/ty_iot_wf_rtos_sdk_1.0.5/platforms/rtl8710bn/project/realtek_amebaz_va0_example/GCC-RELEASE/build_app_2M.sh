#!/bin/sh
echo ""
echo "start..."
echo ""
set -e

BUILD_TYPE=8710_2M

#clean
make APP_BIN_NAME=$APP_BIN_NAME USER_SW_VER=$USER_SW_VER BUILD_TYPE=$BUILD_TYPE clean
#ota1
make APP_BIN_NAME=$APP_BIN_NAME USER_SW_VER=$USER_SW_VER BUILD_TYPE=$BUILD_TYPE -C ./
echo "1111111111111111111111111111111111111111111111111111111111111111111"

#ota2
make APP_BIN_NAME=$APP_BIN_NAME USER_SW_VER=$USER_SW_VER BUILD_TYPE=$BUILD_TYPE ota_idx=2 -C ./
echo "2222222222222222222222222222222222222222222222222222222222222222222"

rm ../../../tuya_app_common/src/main.o
#mp
make APP_BIN_NAME=$APP_BIN_NAME USER_SW_VER=$USER_SW_VER BUILD_TYPE=$BUILD_TYPE MP=1 mp -C ./
echo "3333333333333333333333333333333333333333333333333333333333333333333"

#do package
#BIN_PATH=tuya_user/$APP_BIN_NAME/output/$USER_SW_VER
BIN_QIO=../../../../../apps/$APP_BIN_NAME/output/$USER_SW_VER/${APP_BIN_NAME}_QIO_$USER_SW_VER.bin
BIN_DOUT=../../../../../apps/$APP_BIN_NAME/output/$USER_SW_VER/${APP_BIN_NAME}_DOUT_$USER_SW_VER.bin
BIN2=boot_all.bin
BIN4=../../../../../apps/$APP_BIN_NAME/output/$USER_SW_VER/mp_${APP_BIN_NAME}_\(1\)_$USER_SW_VER.bin
BIN5=../../../../../apps/$APP_BIN_NAME/output/$USER_SW_VER/${APP_BIN_NAME}_\(2\)_$USER_SW_VER.bin

./package_2M $BIN_QIO $BIN2 system_qio_2M.bin $BIN4 $BIN5
echo "package_2M QIO file success"

./package_2M $BIN_DOUT $BIN2 system_dout_2M.bin $BIN4 $BIN5
echo "package DOUT file success"



